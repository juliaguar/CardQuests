<html>
<body>


<script src="raphael-min.js"></script>
<div id="cardtable"></div>
<h2 id="phase-number">-</h2>
<div id="phase-description">-</div>

<script>


var paper = Raphael(document.getElementById("cardtable"), 1200, 600);


var cardWidth = 150;
var cardHeight = 200;
var cardRadius = 50;

var discardedCardsX = 70;
var discardedCardsY = 400;

var deckX = 70;
var deckY = 270;

var setPhaseLabel = function(number, description) {
	document.getElementById("phase-number").innerHTML = "Phase " + number;
	document.getElementById("phase-description").innerHTML = description;
}


var Deck = function() {

	var blankCard = paper.circle(deckX, deckY, cardRadius);
	blankCard.attr({
		fill: "0-#fff-#f00:20-#000",
	});

	this.setAction = function(action) {
		blankCard.click(action);
	}
};

var DropArea = function() {
	var cardBorder = 10;

	var area = paper.circle(discardedCardsX, discardedCardsY, cardRadius + 10);
	area.attr({
		"stroke-dasharray": "--",
		"fill": "grey"
	});

	
};

var CardView = function(color, number, cardX, cardY) {


	this.moveBack = false;
	var _this = this;

	var card = paper.set(); 

	var blankCard = paper.circle(cardX, cardY, cardRadius);
	blankCard.attr({
		fill: color,
	});

	var numberLabel = paper.text(cardX, cardY, number);
	numberLabel.attr({
		"font-size": 70,
		"fill": "white"
	})

	card.push(blankCard, numberLabel);

	// default is hidden

	card.hide();

	// Make removable, hideable, showable..

	this.setPos = function(x,y) {
		card.attr('x', x);
		card.attr('y', y);
		card.attr('cx', x);
		card.attr('cy', y);
	};

	this.remove = function() {
		card.remove();
	}

	this.hide = function() {
		card.hide();
	}

	this.show = function() {
		card.show();
	}

	this.setAction = function(action) {
		card.mousedown(action);
	}

	this.removeAction = function() {
		card.unlick();
	}

	// drop card
	this.discardCard = function() {
		this.moveBack = true;
		card.toFront();
		_this.setPos(discardedCardsX, discardedCardsY);
	}

	this.retake = function() {
		this.moveBack = false;
	}



	// Make dragabe cards

	var dragging;

	card.drag(function(dx, dy, x, y) {

			// card.forEach(function(element) {
			// 	element.attr('x', element.data('originX') + dx);
			// 	element.attr('y', element.data('originY') + dy);

			// });

			_this.setPos(x, y);
			

	}, function(x, y) {
			card.toFront();

			dragging = true;

			if(hoverGlow) hoverGlow.remove();

			_this.originX = card[0].attr('x');
			_this.originY = card[0].attr('y');


	}, function() {
		dragging = false;

		if(_this.moveBack) {
			console.log("move back");
			_this.setPos(_this.originX, _this.originY);
		}
	});


	var hoverGlow;

	card.mouseover(function() {
		//this.attr("fill", "white");
		if(!dragging) {
			hoverGlow = blankCard.glow({
				color: "yellow",
				width: 15
			});
		}
	});

	card.mouseout(function() {
		if(hoverGlow) {
			hoverGlow.remove();
		}
	});
}

var Button = function(text, id, action) {


	var button = paper.add([
    {
        type: "rect",
        x: 20,
        y: 20 + id * 60,
        width: 100,
        height: 50,
        r: 10,
        fill: "#ccc"
    },
    {
        type: "text",
        x: 70,
        y: id * 60 + 45,
        text: text,
        'font-size': 20
    }
	]);


	button.click(function() {
		console.log(action);
		action();
	});

	this.hide = function() {
		return button.hide;
	}

	this.show = function() {
		return button.show;
	}
};

var PlayerList = function(players) {

	var playerList = paper.set();

	var playerLabel = [];

	var title = paper.text(130, 20, "Players");
	title.attr({
		"font-size": 20,
		"text-anchor": "start",
		"font-weight": "bold"
	});

	for(var i = 0; i < players.length; i++) {

		playerLabel[i] = paper.text(140, i * 40 + 60, players[i].name)
		playerLabel[i].attr({
			"font-size": 20,
			"text-anchor": "start"
		});
		playerList.push(playerLabel[i]);
	}

	this.highlightPlayer = function(playerID) {

		playerList.forEach(function(player) {
			player.attr({
				fill: "black"
			})
		});

		playerLabel[playerID].attr({
			fill: "red"
		});
	};

};


</script>

<script src="game.js"></script>


</body>
</html>